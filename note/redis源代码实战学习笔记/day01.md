# Redis源代码阅读

1. 为啥阅读源码

    * 进一步掌握redis的实现细节、便于排查性能故障问题
    * 从原理到源码，学习源码阅读的方法，培养源码习惯、掌握学习主动权
    * 学习良好的编程规范、写出高质量的代码
    * 举一反三，学习计算机系统设计思想，实现职业能力进阶
        * 掌握单机KV数据库的关键技术：
            * 包括支持高性能访问的数据结构
            * 支持高效空间利用率的数据结构
            * 网络服务器高并发通信
            * 高效线程执行模型
            * 内存管理
            * 日志机制
        * 掌握分布式系统的关键技术
            * 分布式系统主从复制机制
            * 可扩展集群数据切片与放置技术
            * 可扩展集群通信机制
        * 掌握计算机系统设计思想
            * 数据结构
                * 数据结构内存优化
                * 高性能数据结构设计
            * 高并发网络通信
                * IO复用
                * 事件驱动框架
            * 线程模型
                * 异步线程任务
                * 线程通信
            * 内存管理
                * 惰性删除
                * LRU/LFU替换算法与优化
            * 主从复制
                * 数据主从同步
                * 网络故障容错
            * 切片集群
                * Gossip协议开发
                * 数据放置
            * 日志

2. 目录结构
    * deps 第三方依赖包，可以独立于redis存在和发展
        * hiredis redis的C语言版本客户端
        * jemalloc 内存分配器代码
        * lua lua脚本支持
        * linenoise 命令行解析
    * src
        * modules示例代码
        * 各功能模块代码
    * 配置文件
        * redis.conf服务配置文件
        * sentinel哨兵配置文件
    * utils目录
        * create-cluster子目录，创建集群工具代码
        * hashtable子目录，rehash过程可视化代码
        * hyperloglog子目录，hyperloglog误差率计算和展示代码
        * lru子目录，LRU算法效果展示代码
    * test目录
        * 测试代码子目录
            * unit单元测试代码
            * cluster集群功能测试代码
            * sentinel哨兵功能测试代码
            * integration主从赋值功能测试代码
        * 测试支撑代码子目录
            * assets
            * helpers
            * modules
            * support

3. 代码路径
    * 服务器实例
        * server.c/server.h:Redis运行时是一个网络服务器实例，因此需要有代码实现服务器实例的初始化和主题控制流程
        * 对于一个网络服务器，还需要提供网络通信功能，Redis使用了事件驱动机制的网络通信框架，涉及的代码：ae.h/ae.c,ae_epoll.c,ae_evport.c,ae_kqueue.c,ae_select.c
        * 与网络通信相关的功能：包括底层的TCP网络通信和客户端实现，Redis对TC网络通信的Socket连接、设置等操作进行了封装、封装后的函数在anet.h/anet.c中
        * 客户端在redis运行过程中也会被广泛使用，比如实例返回对去的数据，主从复制时主从库间传输数据，RedisCluster的切片实例通信等都会用到客户端，Redis将客户端的创建、消息回复等功能实现在了networking.c
    * 数据库数据类型操作
      * 数据类型
      * 数据库KV对的新增、查询、修改、删除等操作接口封装在db.c
      * Redis优化内存是从：内存分配、内存回收、数据替换
        * 内存分配方面